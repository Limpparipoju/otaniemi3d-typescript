<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">

<link rel="import" href="../../lib/moment.html">
<link rel="import" href="../decode-html/decode-html.html">

<dom-module id="manga-info">
  <template class="layout horizontal">

    <style>
      paper-card.description {
        display: flex;
        align-items: flex-start;
        height: 20em;
        margin: 5px;
      }
      .cover {
        position: relative;
        margin-right: 1em;
        height: 100%;
        width: 12.4em;
        overflow: hidden;
      }
      .cover img {
        position: absolute;
        height: 100%;
        min-width: 100%;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }
      .body {
        flex: 1;
      }
      .footer {
        position: absolute;
        bottom: 0.5em;
      }
      .genre-tag {
        display: inline-block;
        border: 1px solid black;
        border-radius: 2px;
        padding: 2px;
        margin-right: 0.5em;
      }
      .chapter-item {
        width: 100%;
      }
      .chapter-item .card-content {
        display: flex;
        justify-content: space-between;
      }
    </style>

    <iron-ajax url="../../assets/data/manga-list.json" handle-as="json"
        on-response="_getMangaByAlias"
        auto>
    </iron-ajax>
    <iron-ajax id="mangaAjax"
        url="" handle-as="json"
        last-response="{{manga}}">
    </iron-ajax>

    <paper-card class="description">
      <div class="cover">
        <img src$="[[_imageUrl(manga.image)]]">
      </div>
      <div class="body">
        <h2>[[manga.title]]</h2>
        <decode-html text="[[manga.description]]"></decode-html>
        <div class="footer">
          <template is="dom-repeat" items="[[manga.categories]]" as="genre">
            <div class="genre-tag">[[genre]]</div>
          </template>
        </div>
      </div>
    </paper-card>

    <div class="layout vertical">
      <template is="dom-repeat" items="[[manga.chapters]]" as="chapter">
        <a href$="[[_chapterUrl(chapter)]]">
          <paper-card class="chapter-item">
            <div class="card-content">
              <span>[[_chapterTitle(chapter)]]</span>
              <span>[[_chapterDate(chapter)]]</span>
            </div>
          </paper-card>
        </a>
      </template>
    </div>

  </template>
</dom-module>

<script src="manga-info.js"></script>
